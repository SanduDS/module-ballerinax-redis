name: Deployment

on:
  release:
    types: [published]

jobs:
  build:

    runs-on: ubuntu-latest

    steps:
        - uses: actions/checkout@v2
        - name: Set up JDK 11
          uses: actions/setup-java@v1
          with:
              java-version: 11 
        - name: Maven Build
          run: mvn clean install 
        - name: Ballerina Build
          uses: ballerina-platform/ballerina-action/@swan-lake-connector-release
          with:
            args:
              build -c --skip-tests redis
          env:
            JAVA_HOME: /usr/lib/jvm/default-jvm 
            JAVA_OPTS: -DBALLERINA_DEV_COMPILE_BALLERINA_ORG=true
        - name: Ballerina Push
          uses: ballerina-platform/ballerina-action/@swan-lake-connector-release
          with:
            args: 
              push
          env:
            JAVA_HOME: /usr/lib/jvm/default-jvm
            WORKING_DIR: ./redis
            BALLERINA_CENTRAL_ACCESS_TOKEN: ${{ secrets.BALLERINA_CENTRAL_ACCESS_TOKEN }}
